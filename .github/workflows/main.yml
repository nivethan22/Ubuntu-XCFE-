name: Setup XFCE with GetScreenMe Remote Access

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  setup:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Update and install dependencies
      run: |
        sudo apt update && sudo apt upgrade -y
        sudo apt install -y \
          xfce4 \
          xfce4-goodies \
          xorg \
          wget \
          curl \
          gnupg2 \
          lsb-release \
          sudo \
          xfce4-session \
          pulseaudio \
          dbus-x11 \
          xrdp

    - name: Install GetScreenMe for Remote Access
      run: |
        # Install necessary dependencies
        sudo apt install -y curl gnupg2

        # Download GetScreenMe installation script
        curl -fsSL https://getscreen.me/getscreenme.sh | sudo bash

        # Start GetScreenMe service
        sudo systemctl enable getscreenme
        sudo systemctl start getscreenme

    - name: Set up XFCE session for GetScreenMe
      run: |
        # Set XFCE as the default desktop environment
        echo "xfce4-session" > /home/runner/.xsession
        sudo chown runner:runner /home/runner/.xsession

    - name: GetScreenMe Authentication Code (Manual Step)
      run: |
        echo "Now, follow these steps to authenticate with GetScreenMe:"
        echo "1. Open GetScreenMe in a browser."
        echo "2. Use the generated code to authenticate your session."
        echo "3. After authentication, connect to your VM via the browser using the code."

    - name: Final Message
      run: |
        echo "Setup complete. You can now access your virtual machine via GetScreenMe."
