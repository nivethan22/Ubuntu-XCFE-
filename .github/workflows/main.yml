name: Setup XFCE with VNC Remote Access

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  setup:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Update and install dependencies
      run: |
        sudo apt update && sudo apt upgrade -y
        sudo apt install -y \
          xfce4 \
          xfce4-goodies \
          xorg \
          wget \
          curl \
          gnupg2 \
          lsb-release \
          sudo \
          xfce4-session \
          pulseaudio \
          dbus-x11 \
          xrdp \
          tightvncserver  # Install VNC server

    - name: Set up VNC Server with XFCE
      run: |
        # Create a password for the VNC server
        mkdir -p /home/runner/.vnc
        echo "yourpassword" | vncpasswd -f > /home/runner/.vnc/passwd
        chmod 600 /home/runner/.vnc/passwd
        
        # Start the VNC server
        vncserver :1 -geometry 1280x1024 -depth 24
        
        # Set up XFCE session for VNC
        echo "xfce4-session" > /home/runner/.vnc/xstartup
        chmod +x /home/runner/.vnc/xstartup

        # Restart VNC server to load the new session
        vncserver -kill :1
        vncserver :1 -geometry 1280x1024 -depth 24

    - name: VNC Authentication (Manual Step)
      run: |
        echo "Now, follow these steps to authenticate with VNC:"
        echo "1. Open a VNC client on your local machine."
        echo "2. Connect to the following address: {runner_ip}:1"
        echo "3. Use the password 'yourpassword' to authenticate."
        
    - name: Final Message
      run: |
        echo "VNC setup complete. You can now access your VM via VNC using a VNC client."
